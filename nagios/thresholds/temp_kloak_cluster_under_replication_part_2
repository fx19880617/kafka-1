#under replication alerts, refer the following for more information on this alert
#https://code.uberinternal.com/w/projects/kloak/monitoring/alerts/
boxes = 'kloak*-sjc1'
warn_thresholds = {
}
critical_thresholds = {
    'cluster_under_replication_partition_6': 0.99,
    'cluster_under_replication_partition_7': 0.99,
    'cluster_under_replication_partition_8': 0.99,
}
checks = {
    'cluster_under_replication_partition_6': 'highestMax(movingAverage(servers.' + boxes + '.*.kafka.cluster.Partition.UnderReplicated.*.6.value,"15min"),1)',
    'cluster_under_replication_partition_7': 'highestMax(movingAverage(servers.' + boxes + '.*.kafka.cluster.Partition.UnderReplicated.*.7.value,"15min"),1)',
    'cluster_under_replication_partition_8': 'highestMax(movingAverage(servers.' + boxes + '.*.kafka.cluster.Partition.UnderReplicated.*.8.value,"15min"),1)',
}
for check in checks:
    graphite.absolute_threshold(checks[check], alias=check, warning_over=warn_thresholds.get(check), critical_over=critical_thresholds.get(check))
